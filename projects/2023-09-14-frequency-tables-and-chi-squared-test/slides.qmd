---
title: "Unlocking Insights (I): Analyzing Categorical Data with Cross-Tab and Chi-Squared Test"
description: "Discover how to extract valuable insights from categorical data using frequency tables and the chi-squared test, with a case study on gender representation in senior roles."
categories: [frequency tables, chi-squared test, categorical data, quantitative analysis]
draft: true
format: 
  revealjs: 
   theme: theme.scss
   transition: fade
   background-transition: fade
   embed-resources: true
code-link: true
toc-depth: 1
execute:
  echo: true
  freeze: auto
---

# Overview of the Content

```{r}
#| echo: false
 library(tidyverse)
 library(kableExtra)
```

## Introducing two distinct tools for data analysis with categorical data using R

-   Frequency tables
-   Chi-squared test

## Case study

-   Focused on diversity and inclusion (D&I)
-   Sourced from the book [Predictive HR Analytics : Mastering the HR Metric](https://www.amazon.com/Predictive-HR-Analytics-Mastering-Metric/dp/0749473916)
-   With data available [here](https://www.koganpage.com/hr-learning-development/predictive-hr-analytics-9780749484446)

## Data preparation and exploration

-   Packages: `tidyverse`, `kableExtra` 
-   Data preparation and exploration
-   Creation of cross-tab
-   Data visualization
-   Chi-squared test

# Problem Statement

## The business needs

:::goal
:::small
A hypothetical company aims to employ scientific methods and procedures to address a significant people problem: gender diversity.
:::
:::

-   **Commercial perspective**

    -   The organization seeks to foster a greater diversity of thought in senior and strategic discussions.

-   **People perspective**

    -   The organization wants to assess whether it maintains gender balance by providing positive role models for younger employees.

## The research question

<br>

::: goal
Are women underrepresented in senior leadership roles within the organization?
:::

# Data Preparation and Exploration

## Look at the data - The structure

:::small

```{r}
#| label: read-data
#| echo: true
#| warning: false

diversity <- read_csv("../2023-09-14-frequency-tables-and-chi-squared-test/diversity1.csv")
glimpse(diversity)

```

-   The organization, a management consulting firm, has 1,493 employees.
-   The data set contains 11 variables.
-   Data type: double <dbl> for all variables.
:::

## Description of variables of interest

<br>

::: small
::: columns
::: {.column width="65%"}
| Level | Job Grade                   |
|-------|-----------------------------|
| 1     | Clerical/Officer            |
| 2     | Administrator/Assistant     |
| 3     | Graduate/Trainee Consultant |
| 4     | Consultant                  |
| 5     | Senior Consultant           |
| 6     | Managing Consultant         |
| 7     | Principal Consultant        |
| 8     | Partner                     |
:::

::: {.column width="35%"}
| Level | Gender |
|-------|--------|
| 1     | Female |
| 2     | Male   |
:::
:::
:::

## Data preparation (I)

-   Create new variables *gender* and *jobgrade*.
-   Replace numerical values with descriptive labels for both variables.

```{r}
#| label: new-variables
#| echo: true
#| warning: false

# create new variables "gender" and "jobgrade"
diversity <- diversity|>
  mutate(gender= factor(Gender,
                        levels= c(1:2),
                        labels= c("Female", "Male")),
         jobgrade= factor(JobGrade,
                          levels= c(1:8),
                          labels= c("Clerical/Officer", "Administrator/Assistant", "Graduate/Trainee Consultant", "Consultant", "Senior Consultant", "Managing Consultant", "Principal Consultant", "Partner")))


```

## Data preparation (II)

-   Detect and rectify inaccuracies in the data

```{r}
#| label: new-variables-levels
#| echo: true
#| warning: false
#| output: false

# variables' levels
diversity|>
  distinct(gender, jobgrade)

# filter and drop "NA" levels and name the new data frame "diversity1"
diversity1 <- diversity|>
  filter(gender!="NA")|>
  droplevels()

#variables' levels filtered
diversity1|>
  distinct(gender, jobgrade)



```

## Cross-tab for insights

::: small
```{r}
#| label: cross-tab
#| echo: true
#| warning: false

# cross-tab; count and make a table for "gender" and "jobgrade" data
diversity1|>
  count(gender, jobgrade)|>
  pivot_wider(names_from = gender, values_from = n)|>
  kable(col.names = c("JobGrade", "Female", "Male"),
        align = "lrr")
```
:::

## Proportions of gender within each jobgrade

::: small
```{r}
#| label: proportions
#| echo: true
#| warning: false

diversity1|>
  count(gender, jobgrade)|>
  group_by(jobgrade)|>
  mutate(prop= round(n/sum(n)*100),2)|>
  pivot_wider(id_cols = jobgrade, names_from = gender, values_from = prop)|>
  kable(col.names = c("Job Grade", "Female (%)", "Male (%)"),
        align = "lrr")

  
```
:::

## Gender by job grade

::: small
```{r}
#| label: graph I
#| echo: true
#| warning: false
#| fig-width: 8
#| fig-height: 4
#| fig-align: center

ggplot(diversity1, aes(x=jobgrade, fill=gender))+
  geom_bar(position = "fill", width = 0.7)+
  labs(title = "Gender by Job Grade",
      x = "Job Grade",
      y = "Proportions",
      fill= "Gender")+
  theme_minimal(base_size = 14)+
  scale_fill_manual(values = c("Female" = "#00589b", "Male"= "#ccddeb"))+
  coord_flip()


```
:::

## Are women underrepresented in senior leadership roles within the organization?

::: goal
::: small
Up to this point, the data reveal a clear pattern: men are more common in senior roles, while women tend to occupy junior positions.
:::
:::

```{r}
#| label: graph II
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-align: center

ggplot(diversity1, aes(x=jobgrade, fill=gender))+
  geom_bar(position = "fill", width = 0.7)+
  labs(title = "Gender by Job Grade",
      x = "Job Grade",
      y = "Proportions",
      fill= "Gender")+
  theme_minimal(base_size = 14)+
  scale_fill_manual(values = c("Female" = "#00589b", "Male"= "#ccddeb"))+
  coord_flip()

 
```

## Does this organization have a D&I issue?

<br>

-   The data indicate a pattern where women are more commonly in junior roles and men in senior roles.
-   However, it's unclear from the data whether this pattern is coincidental or statistically significant.
-   To assess this, we can employ a chi-squared test to determine the statistical significance of the observed pattern.

# Chi-Squared Test

## The hypotheses

<br>

::: small
**H0**: There is no association between gender and job grade within the organization.

-   the observed distribution of females and males across job grades is due to random chance.

**H1**: There is a significant association between gender and job grade within the organization.

-   the observed distribution of females and males across job grades is not a result of random chance; it reflects a significant pattern of male predominance in senior roles and a greater representation of females in entry-level positions.
:::

## Chi squared test in R

```{r}
#| label: chi-squared-test
#| echo: true
#| warning: false

cross_tab <- table(diversity1$jobgrade, diversity1$gender)
chisq.test(cross_tab)
```

::: goal
::: small
-   The p-value is extremely small, less than 2.2e-16, which is very close to zero.
-   Since the p-value is less than the significance level of 0.05, we can confidently reject the null hypothesis, concluding that the two variables are dependent.
-   This result indicates a statistically significant association between gender and job grade.
-   It suggests that certain factors are influencing the observed distribution of genders within job grades.
:::
:::

# Conclusions

## Analyzing gender distribution across job grades

-   Frequency tables and graphical visualization offer a concise summary of gender distribution across job grades, revealing a clear pattern: **men are more common in senior roles, while women predominantly hold junior positions.**

-   The results of the chi-squared test, with a p-value close to zero, confirm **a very strong association between gender and job grade.**

## Recommendation

-   While this statistical evidence does not directly imply that there is a D&I problem within the organization, it signals that factors beyond chance influence this distribution.
-   To address potential gender bias or discrimination and foster diversity and inclusion within the organization, further analysis and actions are necessary.
